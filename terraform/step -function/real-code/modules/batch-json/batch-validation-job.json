{
  "name": "${PREFIX}-batch-validation-job",
  "type": "container",
  "platform_capabilities": ["EC2"],
  "container_properties": {
    "image": "public.ecr.aws/lambda/python:3.9",
    "vcpus": 4,
    "memory": 8192,
    "command": [
      "/opt/batch-processing/batch_validator.py",
      "--bucket", "Ref::bucket",
      "--file", "Ref::file",
      "--customer-id", "Ref::customerId",
      "--tenant-id", "Ref::tenantId",
      "--batch-id", "Ref::batchId",
      "--deployment", "Ref::deployment"
    ],
    "environment": [
      {
        "name": "AWS_REGION",
        "value": "${AWS_REGION}"
      },
      {
        "name": "S3_BUCKET",
        "value": "Ref::bucket"
      }
    ],
    "job_role_arn": "${SCM_BATCH_PROCESSOR_BATCH_ROLE}",
    "execution_role_arn": "${SCM_BATCH_PROCESSOR_BATCH_INSTANCE_ROLE}",
    "user_data": "base64encode(templatefile(\"${BATCH_PATH}/batch_user_data.sh\", { BUCKET_NAME = \"Ref::bucket\", REGION = \"${AWS_REGION}\" }))",
    "resource_requirements": [
      {
        "type": "VCPU",
        "value": "4"
      },
      {
        "type": "MEMORY",
        "value": "8192"
      }
    ],
    "log_configuration": {
      "log_driver": "awslogs",
      "options": {
        "awslogs-group": "/aws/batch/${PREFIX}-batch-validation",
        "awslogs-region": "${AWS_REGION}",
        "awslogs-stream-prefix": "ecs"
      }
    }
  },
  "retry_strategy": {
    "attempts": 3,
    "evaluate_on_exit": [
      {
        "action": "RETRY",
        "on_exit_code": "1",
        "on_reason": ".*"
      },
      {
        "action": "EXIT",
        "on_exit_code": "2",
        "on_reason": ".*"
      }
    ]
  },
  "timeout": {
    "attempt_duration_seconds": 7200
  },
  "tags": ${TAGS}
} 